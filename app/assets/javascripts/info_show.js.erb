window.onload = page_ready
function page_ready(){

  filter_init();
  // filter_form();
  real_time_data_init();
  get_real_time_data();
  document.getElementById('locale-form').addEventListener('change',function(){
    this.submit();
  })

}
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems);
  });
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.collapsible');
    var instances = M.Collapsible.init(elems);
  });
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.sidenav');
    var instances = M.Sidenav.init(elems);
  });
var real_time_data;
var init_data;

function real_time_data_init() {
    real_time_data = new Vue({
      el: '#real-time-data',
      data: {data: [[]]}
    })
}
var filter = [];
function filter_init() {
    filter_data = new Vue({
      el: '#filter',
      data: {filters: [], selected_filters: []}
    })
}
function get_real_time_data(){
  if (window.location.pathname.includes("/infos/")){
    let id = window.location.pathname.split("/").pop()

    var link = `${window.location.protocol}//${window.location.host}/get/${id}`;
    var data = {};
    function http_request() {
      Vue.http.get(link).then(function(response){
        data = response.data.data;
        if (filter_data.filters.length == 0){
          var temp =[]
          data.forEach((item, index)=>{
            temp[index] = item[0]
          })
          filter_data.filters = temp
        }
        data = data.filter((current)=>{
          if (filter_data.selected_filters.includes(current[0])){
            return current;
          }
        })
        real_time_data.data = data;
      }, function(error){
        console.log(error.statusText);
      });
    }
    http_request.call(this)
        var elems = document.querySelectorAll('.collapsible');
        var instances = M.Collapsible.init(elems);
    setInterval(http_request.bind(this), 100)
  }
}
